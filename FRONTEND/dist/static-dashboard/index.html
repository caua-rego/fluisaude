<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FluiSaúde — Dashboard (estático)</title>
  <style>
    :root{font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial}
    body{margin:0;background:#f8fafc;color:#0f172a}
    header{background:linear-gradient(90deg,#0ea5a4,#6366f1);color:white;padding:20px}
    .container{max-width:1100px;margin:24px auto;padding:16px}
    nav{display:flex;gap:8px;margin-bottom:16px}
    button{background:#111827;color:white;border:0;padding:8px 12px;border-radius:6px;cursor:pointer}
    button.secondary{background:#6b7280}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border:1px solid #e6edf3;padding:8px;text-align:left}
    form{display:flex;flex-wrap:wrap;gap:8px}
    input,select{padding:8px;border:1px solid #d1e3ee;border-radius:6px;width:220px}
    .hidden{display:none}
    .row{display:flex;gap:8px;align-items:center}
    h1,h2{margin:0}
    .actions{margin-left:auto}
    .msg{padding:8px;background:#e6fffa;border-radius:6px;margin:8px 0}
  </style>
</head>
<body>
  <header>
    <div class="container" style="display:flex;align-items:center;gap:16px">
      <h1>FluiSaúde — Dashboard (estático)</h1>
      <div class="actions">
        <button id="refreshAll">Atualizar tudo</button>
      </div>
    </div>
  </header>

  <main class="container">
    <nav>
      <button data-tab="pacientes">Pacientes</button>
      <button data-tab="medicos">Médicos</button>
      <button data-tab="especialidades">Especialidades</button>
      <button data-tab="consultas">Consultas</button>
    </nav>

    <section id="pacientes" class="tab">
      <h2>Pacientes</h2>
      <div class="row">
        <form id="pacienteForm">
          <input name="id" type="hidden" />
          <input name="nome" placeholder="Nome" required />
          <input name="cpf" placeholder="CPF" required />
          <input name="telefone" placeholder="Telefone" />
          <button type="submit">Salvar</button>
          <button type="button" class="secondary" id="pacienteClear">Limpar</button>
        </form>
      </div>
      <div id="pacientesMsg" class="msg hidden"></div>
      <table id="pacientesTable"><thead><tr><th>ID</th><th>Nome</th><th>CPF</th><th>Telefone</th><th>Ações</th></tr></thead><tbody></tbody></table>
    </section>

    <section id="medicos" class="tab hidden">
      <h2>Médicos</h2>
      <div class="row">
        <form id="medicoForm">
          <input name="id" type="hidden" />
          <input name="nome" placeholder="Nome" required />
          <input name="crm" placeholder="CRM" required />
          <select name="especialidade_id"><option value="">Selecione especialidade</option></select>
          <button type="submit">Salvar</button>
          <button type="button" class="secondary" id="medicoClear">Limpar</button>
        </form>
      </div>
      <div id="medicosMsg" class="msg hidden"></div>
      <table id="medicosTable"><thead><tr><th>ID</th><th>Nome</th><th>CRM</th><th>Especialidade</th><th>Ações</th></tr></thead><tbody></tbody></table>
    </section>

    <section id="especialidades" class="tab hidden">
      <h2>Especialidades</h2>
      <div class="row">
        <form id="especialidadeForm">
          <input name="id" type="hidden" />
          <input name="nome" placeholder="Nome da especialidade" required />
          <button type="submit">Salvar</button>
          <button type="button" class="secondary" id="espClear">Limpar</button>
        </form>
      </div>
      <div id="espMsg" class="msg hidden"></div>
      <table id="espTable"><thead><tr><th>ID</th><th>Nome</th><th>Ações</th></tr></thead><tbody></tbody></table>
    </section>

    <section id="consultas" class="tab hidden">
      <h2>Consultas</h2>
      <div class="row">
        <form id="consultaForm">
          <input name="id" type="hidden" />
          <select name="paciente_id"><option value="">Selecione paciente</option></select>
          <select name="medico_id"><option value="">Selecione médico</option></select>
          <input name="data_agendamento" type="datetime-local" required />
          <select name="status"><option value="agendada">agendada</option><option value="confirmada">confirmada</option><option value="cancelada">cancelada</option></select>
          <button type="submit">Salvar</button>
          <button type="button" class="secondary" id="consultaClear">Limpar</button>
        </form>
      </div>
      <div id="consultasMsg" class="msg hidden"></div>
      <table id="consultasTable"><thead><tr><th>ID</th><th>Paciente</th><th>Médico</th><th>Data</th><th>Status</th><th>Ações</th></tr></thead><tbody></tbody></table>
    </section>
  </main>

  <script>
    const API = 'http://localhost:5001/api'; // ajustável

    // helpers
    const qs = (s, el=document) => el.querySelector(s);
    const qsa = (s, el=document) => Array.from(el.querySelectorAll(s));
    const showMsg = (el, text) => { el.textContent = text; el.classList.remove('hidden'); setTimeout(()=>el.classList.add('hidden'),3000); };

    // Tab switching
    qsa('nav button').forEach(btn => btn.addEventListener('click', ()=>{
      const tab = btn.dataset.tab;
      qsa('.tab').forEach(t=>t.classList.add('hidden'));
      qs(`#${tab}`).classList.remove('hidden');
      if(tab==='medicos' || tab==='consultas') loadEspecialidades();
      if(tab==='consultas') loadPacientes();
      if(tab==='medicos') loadMedicos();
    }));

    // Pacientes
    async function loadPacientes(){
      const res = await fetch(`${API}/pacientes`);
      const data = await res.json();
      const tbody = qs('#pacientesTable tbody'); tbody.innerHTML='';
      data.forEach(p=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${p.id}</td><td>${p.nome}</td><td>${p.cpf}</td><td>${p.telefone||''}</td><td><button data-id="${p.id}" data-action="edit">Editar</button> <button data-id="${p.id}" data-action="del">Deletar</button></td>`;
        tbody.appendChild(tr);
      });
      // populate select for consultas
      const pacienteSelect = qs('select[name="paciente_id"]'); if(pacienteSelect){ pacienteSelect.innerHTML = '<option value="">Selecione paciente</option>' + data.map(p=>`<option value="${p.id}">${p.nome}</option>`).join(''); }
    }

    qs('#pacienteForm').addEventListener('submit', async (e)=>{
      e.preventDefault(); const f = e.target; const id=f.id.value; const body={nome:f.nome.value,cpf:f.cpf.value,telefone:f.telefone.value};
      if(id){ await fetch(`${API}/pacientes/${id}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}); showMsg(qs('#pacientesMsg'),'Paciente atualizado'); }
      else { await fetch(`${API}/pacientes`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}); showMsg(qs('#pacientesMsg'),'Paciente criado'); }
      f.reset(); loadPacientes();
    });
    qs('#pacientesTable').addEventListener('click', async (e)=>{
      const btn = e.target.closest('button'); if(!btn) return; const id=btn.dataset.id; if(btn.dataset.action==='edit'){ const res=await fetch(`${API}/pacientes/${id}`); const p=await res.json(); const f=qs('#pacienteForm'); f.id.value=p.id; f.nome.value=p.nome; f.cpf.value=p.cpf; f.telefone.value=p.telefone; }
      if(btn.dataset.action==='del' && confirm('Confirma deletar?')){ await fetch(`${API}/pacientes/${id}`,{method:'DELETE'}); loadPacientes(); }
    });
    qs('#pacienteClear').addEventListener('click', ()=>qs('#pacienteForm').reset());

    // Especialidades
    async function loadEspecialidades(){
      const res = await fetch(`${API}/especialidades`); const data = await res.json();
      const tbody = qs('#espTable tbody'); tbody.innerHTML=''; data.forEach(e=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${e.id}</td><td>${e.nome}</td><td><button data-id="${e.id}" data-action="edit">Editar</button> <button data-id="${e.id}" data-action="del">Deletar</button></td>`; tbody.appendChild(tr); });
      qs('select[name="especialidade_id"]').innerHTML = '<option value="">Selecione especialidade</option>' + data.map(e=>`<option value="${e.id}">${e.nome}</option>`).join('');
    }
    qs('#especialidadeForm').addEventListener('submit', async (e)=>{ e.preventDefault(); const f=e.target; const id=f.id.value; const body={nome:f.nome.value}; if(id){ await fetch(`${API}/especialidades/${id}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}); showMsg(qs('#espMsg'),'Especialidade atualizada'); } else { await fetch(`${API}/especialidades`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}); showMsg(qs('#espMsg'),'Especialidade criada'); } f.reset(); loadEspecialidades(); });
    qs('#espTable').addEventListener('click', async (e)=>{ const btn=e.target.closest('button'); if(!btn) return; const id=btn.dataset.id; if(btn.dataset.action==='edit'){ const res=await fetch(`${API}/especialidades/${id}`); const p=await res.json(); const f=qs('#especialidadeForm'); f.id.value=p.id; f.nome.value=p.nome; } if(btn.dataset.action==='del' && confirm('Confirma deletar?')){ await fetch(`${API}/especialidades/${id}`,{method:'DELETE'}); loadEspecialidades(); } });
    qs('#espClear').addEventListener('click', ()=>qs('#especialidadeForm').reset());

    // Médicos
    async function loadMedicos(){ const res = await fetch(`${API}/medicos`); const data=await res.json(); const tbody=qs('#medicosTable tbody'); tbody.innerHTML=''; data.forEach(m=>{ const espName = m.especialidade?.nome || (m.especialidade_id? ('#'+m.especialidade_id) : 'N/A'); const tr=document.createElement('tr'); tr.innerHTML=`<td>${m.id}</td><td>${m.nome}</td><td>${m.crm}</td><td>${espName}</td><td><button data-id="${m.id}" data-action="edit">Editar</button> <button data-id="${m.id}" data-action="del">Deletar</button></td>`; tbody.appendChild(tr); }); }
    qs('#medicoForm').addEventListener('submit', async (e)=>{ e.preventDefault(); const f=e.target; const id=f.id.value; const body={nome:f.nome.value,crm:f.crm.value,especialidade_id:parseInt(f.especialidade_id.value)}; if(id){ await fetch(`${API}/medicos/${id}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}); showMsg(qs('#medicosMsg'),'Médico atualizado'); } else { await fetch(`${API}/medicos`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}); showMsg(qs('#medicosMsg'),'Médico criado'); } f.reset(); loadMedicos(); });
    qs('#medicosTable').addEventListener('click', async (e)=>{ const btn=e.target.closest('button'); if(!btn) return; const id=btn.dataset.id; if(btn.dataset.action==='edit'){ const res=await fetch(`${API}/medicos/${id}`); const p=await res.json(); const f=qs('#medicoForm'); f.id.value=p.id; f.nome.value=p.nome; f.crm.value=p.crm; f.especialidade_id.value=p.especialidade_id; } if(btn.dataset.action==='del' && confirm('Confirma deletar?')){ await fetch(`${API}/medicos/${id}`,{method:'DELETE'}); loadMedicos(); } });
    qs('#medicoClear').addEventListener('click', ()=>qs('#medicoForm').reset());

    // Consultas
    async function loadConsultas(){ const res=await fetch(`${API}/consultas`); const data=await res.json(); const tbody=qs('#consultasTable tbody'); tbody.innerHTML=''; data.forEach(c=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${c.id}</td><td>${c.paciente_id}</td><td>${c.medico_id}</td><td>${c.data_agendamento}</td><td>${c.status}</td><td><button data-id="${c.id}" data-action="edit">Editar</button> <button data-id="${c.id}" data-action="del">Deletar</button></td>`; tbody.appendChild(tr); }); }
    qs('#consultaForm').addEventListener('submit', async (e)=>{ e.preventDefault(); const f=e.target; const id=f.id.value; const body={paciente_id:parseInt(f.paciente_id.value),medico_id:parseInt(f.medico_id.value),data_agendamento:f.data_agendamento.value,status:f.status.value}; if(id){ await fetch(`${API}/consultas/${id}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}); showMsg(qs('#consultasMsg'),'Consulta atualizada'); } else { await fetch(`${API}/consultas`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}); showMsg(qs('#consultasMsg'),'Consulta criada'); } f.reset(); loadConsultas(); });
    qs('#consultasTable').addEventListener('click', async (e)=>{ const btn=e.target.closest('button'); if(!btn) return; const id=btn.dataset.id; if(btn.dataset.action==='edit'){ const res=await fetch(`${API}/consultas/${id}`); const p=await res.json(); const f=qs('#consultaForm'); f.id.value=p.id; f.paciente_id.value=p.paciente_id; f.medico_id.value=p.medico_id; f.data_agendamento.value=p.data_agendamento.replace('Z',''); f.status.value=p.status; } if(btn.dataset.action==='del' && confirm('Confirma deletar?')){ await fetch(`${API}/consultas/${id}`,{method:'DELETE'}); loadConsultas(); } });
    qs('#consultaClear').addEventListener('click', ()=>qs('#consultaForm').reset());

    // refresh all
    qs('#refreshAll').addEventListener('click', ()=>{ loadPacientes(); loadEspecialidades(); loadMedicos(); loadConsultas(); });

    // initial load
    (async ()=>{ await loadPacientes(); await loadEspecialidades(); await loadMedicos(); await loadConsultas(); })();
  </script>
</body>
</html>
